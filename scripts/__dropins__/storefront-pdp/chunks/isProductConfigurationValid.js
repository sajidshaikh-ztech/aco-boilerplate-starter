/*! Copyright 2025 Adobe
All Rights Reserved. */
import{merge as oe,Initializer as ae}from"@dropins/tools/lib.js";import{events as p}from"@dropins/tools/event-bus.js";import{PRODUCT_FRAGMENT as ne}from"../fragments.js";import{FetchGraphQL as ue}from"@dropins/tools/fetch-graphql.js";function $e(e){const n=new URLSearchParams(window.location.search);Object.entries(e).forEach(([r,t])=>{t===null?n.delete(r):n.set(r,String(t))});let i=window.location.pathname;i+=`?${n.toString()}`,i+=window.location.hash,window.history.replaceState({},"",i)}function le(){const e=new URLSearchParams(window.location.search),n={};return e.forEach((i,r)=>{n[r]=i}),n}function me(e){var n,i,r,t,s,o,l,a,c,m,u,f;return{productId:Number(e==null?void 0:e.externalId),name:e==null?void 0:e.name,sku:(e==null?void 0:e.variantSku)||(e==null?void 0:e.sku),topLevelSku:e==null?void 0:e.sku,specialToDate:void 0,specialFromDate:void 0,newToDate:void 0,newFromDate:void 0,createdAt:void 0,updatedAt:void 0,manufacturer:void 0,countryOfManufacture:void 0,categories:void 0,productType:e==null?void 0:e.productType,pricing:{regularPrice:((i=(n=e==null?void 0:e.prices)==null?void 0:n.regular)==null?void 0:i.amount)||0,minimalPrice:(t=(r=e==null?void 0:e.prices)==null?void 0:r.final)==null?void 0:t.minimumAmount,maximalPrice:(o=(s=e==null?void 0:e.prices)==null?void 0:s.final)==null?void 0:o.maximumAmount,specialPrice:(a=(l=e==null?void 0:e.prices)==null?void 0:l.final)==null?void 0:a.amount,tierPricing:void 0,currencyCode:((m=(c=e==null?void 0:e.prices)==null?void 0:c.final)==null?void 0:m.currency)||"USD"},canonicalUrl:e==null?void 0:e.url,mainImageUrl:(f=(u=e==null?void 0:e.images)==null?void 0:u[0])==null?void 0:f.url}}const ce={PRODUCT_CONTEXT:"productContext"},fe={PRODUCT_PAGE_VIEW:"product-page-view"};function ie(){return window.adobeDataLayer=window.adobeDataLayer||[],window.adobeDataLayer}function Pe(e,n){const i=ie();i.push({[e]:null}),i.push({[e]:n})}function de(e,n){ie().push(r=>{const t=r.getState?r.getState():{};r.push({event:e,eventInfo:{...t,...n}})})}function he(e){const n=me(e);Pe(ce.PRODUCT_CONTEXT,n),de(fe.PRODUCT_PAGE_VIEW)}var q=(e=>(e.ComplexProduct="complex",e.SimpleProduct="simple",e))(q||{}),re=(e=>(e.ComplexProductView="ComplexProductView",e.SimpleProductView="SimpleProductView",e))(re||{});function K(e,n){var o,l,a,c,m,u,f,P,h,y,d,b;const i=((c=(a=(l=(o=e==null?void 0:e.options)==null?void 0:o[0])==null?void 0:l.values)==null?void 0:a[0])==null?void 0:c.__typename)==="ProductViewOptionValueProduct",r=Ee(e,i,n==null?void 0:n.preselectFirstOption),t=(e==null?void 0:e.__typename)===re.SimpleProductView?q.SimpleProduct:q.ComplexProduct,s=e?{name:e.name,sku:e.sku,isBundle:i,addToCartAllowed:e.addToCartAllowed,inStock:e.inStock,shortDescription:e.shortDescription,metaDescription:e.metaDescription,metaKeyword:e.metaKeyword,metaTitle:e.metaTitle,description:e.description,images:we(e),prices:xe(e,i,r),attributes:ye(e),options:De(e,i),optionUIDs:r,url:e.url,urlKey:e.urlKey,externalId:e.externalId,externalParentId:e.externalParentId,variantSku:e.variantSku,productType:t}:null;return oe(s,((P=(f=(u=(m=_.getConfig())==null?void 0:m.models)==null?void 0:u.ProductDetails)==null?void 0:f.transformer)==null?void 0:P.call(f,e))??((b=(d=(y=(h=_.getConfig())==null?void 0:h.models)==null?void 0:y.ProductDetails)==null?void 0:d.transform)==null?void 0:b.call(d,e)))}function we(e){var n,i;return(i=(n=e.images)==null?void 0:n.filter(r=>{var t;return!((t=r.roles)!=null&&t.includes("hide_from_pdp"))}))==null?void 0:i.map(r=>(r.url=r.url.replace(/^https?:/,""),r))}function ye(e){var n,i;return(i=(n=e.attributes)==null?void 0:n.filter(({roles:r})=>(r==null?void 0:r.indexOf("visible_in_pdp"))!==-1))==null?void 0:i.map(({label:r,value:t,name:s})=>({id:s,label:r,value:t.toString().split(",").join(", ")}))}function De(e,n){const{options:i,optionUIDs:r}=e;return i==null?void 0:i.map(({id:t,title:s,required:o,multi:l,values:a})=>{var u;const c=(u=a==null?void 0:a[0])==null?void 0:u.__typename;let m=a==null?void 0:a[0].type;return m?m=m.replace("COLOR_HEX","color").replace("TEXT","text").replace("IMAGE","image"):m="dropdown",{id:t,type:m,typename:c,label:s,required:o,multiple:l,items:n?ge(a,r):Ce(a,r,m)}})}function ge(e,n){return e==null?void 0:e.filter(({enabled:i})=>typeof i>"u"||i).map(({id:i,title:r,inStock:t,isDefault:s,product:o})=>({id:i,inStock:t,label:r,selected:(n==null?void 0:n.indexOf(i))>-1||s,value:i,product:o}))}function Ce(e,n,i){return e==null?void 0:e.map(({id:r,title:t,inStock:s,value:o})=>({id:r,inStock:s,label:t,selected:(n==null?void 0:n.indexOf(r))>-1,value:(i==null?void 0:i.toLowerCase())==="dropdown"?r:o==null?void 0:o.replace(/^https?:/,"")}))}function xe(e,n,i){var d,b,X,B,z;const{price:r,priceRange:t,options:s,optionUIDs:o=i}=e;let{__typename:l}=e;function a(){var x;const g=r.regular.amount.value,w=((x=r.final)==null?void 0:x.amount.value)??r.regular.amount.value,C=r.regular.amount.currency==="NONE"?"USD":r==null?void 0:r.regular.amount.currency;return[g,w,w,C]}function c(){var T,O,k,v,U,A,I,V,F,N,G,M;const g=(T=t==null?void 0:t.minimum)==null?void 0:T.final.amount.value,w=(O=t==null?void 0:t.maximum)==null?void 0:O.final.amount.value;let C;((v=(k=t==null?void 0:t.minimum)==null?void 0:k.regular)==null?void 0:v.amount.value)===((A=(U=t==null?void 0:t.maximum)==null?void 0:U.regular)==null?void 0:A.amount.value)&&(C=(V=(I=t==null?void 0:t.minimum)==null?void 0:I.regular)==null?void 0:V.amount.value);const x=((N=(F=t==null?void 0:t.minimum)==null?void 0:F.final)==null?void 0:N.amount.currency)==="NONE"?"USD":(M=(G=t==null?void 0:t.minimum)==null?void 0:G.final)==null?void 0:M.amount.currency;return[C,g,w,x]}function m(){var k,v,U,A,I,V,F,N,G,M,W,Y;let g=0,w=0;s==null||s.forEach(S=>{var J;const j=S==null?void 0:S.values;if(j&&Array.isArray(j)){const E=j.map(D=>{var $,L,Z,R;return(R=(Z=(L=($=D==null?void 0:D.product)==null?void 0:$.price)==null?void 0:L.regular)==null?void 0:Z.amount)==null?void 0:R.value}).filter(D=>D!==void 0),Q=E.length>0?Math.max(...E):0;g+=Q}(J=S==null?void 0:S.values)==null||J.forEach(E=>{var Q,D,$,L;o!=null&&o.includes(E.id)&&(w+=(L=($=(D=(Q=E==null?void 0:E.product)==null?void 0:Q.price)==null?void 0:D.final)==null?void 0:$.amount)==null?void 0:L.value)})});const C=(k=t==null?void 0:t.minimum)==null?void 0:k.final.amount.value,x=(v=t==null?void 0:t.maximum)==null?void 0:v.final.amount.value;let T;((A=(U=t==null?void 0:t.minimum)==null?void 0:U.regular)==null?void 0:A.amount.value)===((V=(I=t==null?void 0:t.maximum)==null?void 0:I.regular)==null?void 0:V.amount.value)&&(T=(N=(F=t==null?void 0:t.minimum)==null?void 0:F.regular)==null?void 0:N.amount.value);const O=((M=(G=t==null?void 0:t.minimum)==null?void 0:G.final)==null?void 0:M.amount.currency)==="NONE"?"USD":(Y=(W=t==null?void 0:t.minimum)==null?void 0:W.final)==null?void 0:Y.amount.currency;return n&&(o==null?void 0:o.length)<1?[T,C,x,O]:g===(t==null?void 0:t.maximum.regular.amount.value)?[w,w,w,O]:[T,C,x,O]}const[u,f,P,h]=l==="SimpleProductView"?a():n?m():c(),y=l==="SimpleProductView"?(d=r==null?void 0:r.roles)==null?void 0:d.includes("visible"):((X=(b=t==null?void 0:t.maximum)==null?void 0:b.roles)==null?void 0:X.includes("visible"))&&((z=(B=t==null?void 0:t.minimum)==null?void 0:B.roles)==null?void 0:z.includes("visible"));return P&&f===P?{regular:{amount:u,currency:h,variant:u&&f!==u?"strikethrough":"default"},final:{amount:P,currency:h,variant:"default"},visible:y}:{final:{minimumAmount:f,maximumAmount:P,currency:h},visible:y}}function Ee(e,n,i){var r;return n?((r=e==null?void 0:e.options)==null?void 0:r.map(({values:s})=>{var a;const o=((a=s==null?void 0:s.find(({isDefault:c})=>c))==null?void 0:a.id)??null,l=i?s[0].id:null;return o||l})).filter(s=>s!==null):e==null?void 0:e.optionUIDs}const H=new ae({init:async e=>{var a,c,m;const n=(c=(a=e==null?void 0:e.models)==null?void 0:a.ProductDetails)==null?void 0:c.initialData,i=le()||{},r=((m=i.optionsUIDs)==null?void 0:m.split(","))||(n==null?void 0:n.optionsUIDs);let t=1;const s=i.quantity;if(s){const u=parseInt(s,10);!isNaN(u)&&Number.isInteger(u)&&u>0&&(t=u)}const l={...{defaultLocale:"en-US",persistURLParams:!1,acdl:!1,optionsUIDs:r},...e};if(H.config.setConfig({...l}),l!=null&&l.sku){const u=n?K(n):await te(l.sku,{preselectFirstOption:l.preselectFirstOption});p.emit("pdp/data",u);const f={sku:l.sku,quantity:t,optionsUIDs:u==null?void 0:u.optionUIDs};Ue(()=>({...f})),Ie(()=>{var P;return u!=null&&u.options?u.options.length===((P=u==null?void 0:u.optionUIDs)==null?void 0:P.length):!0}),l.acdl&&u&&he(u)}},listeners:()=>[p.on("locale",async()=>{const{sku:e}=H.config.getConfig();if(e){const n=await te(e);p.emit("pdp/data",n)}})]}),_=H.config,{setEndpoint:Le,setFetchGraphQlHeader:Qe,removeFetchGraphQlHeader:je,setFetchGraphQlHeaders:qe,fetchGraphQl:se,getConfig:He}=new ue().getMethods(),pe=`
query GET_PRODUCT_DATA($skus: [String]) {
    products(skus: $skus) {
        ...PRODUCT_FRAGMENT
    }
}

${ne}
`,Te=async(e,n,i)=>{var s;const{data:r}=await se(pe,{method:"GET",variables:{skus:[e]}}),t=(s=r==null?void 0:r.products)==null?void 0:s[0];return n!=null&&n.optionsUIDs&&(t.optionUIDs=n.optionsUIDs),t?i?t:K(t,{preselectFirstOption:n==null?void 0:n.preselectFirstOption}):null},Oe=`
query REFINE_PRODUCT_QUERY(
    $optionIds: [String!]!
    $sku: String!
) {
    # Refined Product
    refineProduct(
        optionIds: $optionIds 
        sku: $sku
    ) {
        ...PRODUCT_FRAGMENT
    }

    # Parent Product
    products(skus: [$sku]) {
        ...PRODUCT_FRAGMENT
    }

    # %extendedPlaceholder%
}

${ne}
`;async function ee(e,n){const i=_e(n),r=be(i,e),t=Oe.replace("# %extendedPlaceholder%",r),{data:s}=await se(t,{method:"GET",variables:{optionIds:n,sku:e}});return s}const Se=async(e,n,i,r)=>{var P,h,y;const t=await ee(e,n);if(!t)return null;let{products:s,refineProduct:o,...l}=t;const a=s==null?void 0:s[0],c=ke(Object.values(l),a.options,i);if(i!=null&&i.length&&o===null){n=ve(c,n,i);const d=await ee(e,n);o=d==null?void 0:d.refineProduct}const m={...o||a,sku:a.sku,name:a.name,externalParentId:a==null?void 0:a.externalId,options:c,optionUIDs:n,variantSku:(o==null?void 0:o.__typename)==="SimpleProductView"?o==null?void 0:o.sku:void 0},u=r?m:K(m),f=(y=(h=(P=_==null?void 0:_.getConfig())==null?void 0:P.models)==null?void 0:h.ProductDetails)==null?void 0:y.fallbackData;return f?f(a,u):u};function _e(e){if(e.length<2)return[e];const n=[];return e.forEach(i=>{const r=[];e.forEach(t=>{i!==t&&r.push(t)}),n.push(r)}),n}function be(e,n){return e.map((i,r)=>`
          ProductOption${r}: refineProduct(
            optionIds: [
              ${i.map(t=>`"${t}"`).join(", ")}
            ]
            sku: "${n}"
          ) {
            ... on ComplexProductView {
              options {
                ...PRODUCT_OPTION_FRAGMENT
              }
            }
          }
        `).join("")}function ke(e,n=[],i){const r=Object.values(e).filter(s=>!!s).reduce((s,o)=>o.options?[...s,...o.options]:[...s],[]),t=new Map(n.map(s=>[s.id,s]));return r.forEach(s=>{i!=null&&i.includes(s.id)||t.set(s.id,s)}),[...t.values()]}function ve(e,n,i){const r=[];let t;return e.forEach(s=>{var o,l,a,c;i.includes(s.id)?t=((l=(o=s.values)==null?void 0:o.find(m=>n.includes(m==null?void 0:m.id)))==null?void 0:l.id)||((a=s.values[0])==null?void 0:a.id):t=(c=s.values[0])==null?void 0:c.id,r.push(t)}),r}const te=async(e,n)=>{const{anchors:i,optionsUIDs:r}=_.getConfig(),{optionsUIDs:t=r,anchors:s=i,preselectFirstOption:o,isBundle:l,skipTransform:a}=n??{};return!l&&t?await Se(e,t,s,a):await Te(e,{preselectFirstOption:o,optionsUIDs:t},a)},Ue=e=>{const n=Ae(),i=e(n);p.emit("pdp/values",{...i})},Ae=()=>{var e;return((e=p._lastEvent["pdp/values"])==null?void 0:e.payload)??null},Ie=e=>{const n=Ve(),i=e(n);p.emit("pdp/valid",i)},Ve=()=>{var e;return((e=p._lastEvent["pdp/valid"])==null?void 0:e.payload)??null};export{Qe as a,qe as b,_ as c,Te as d,Se as e,se as f,He as g,te as h,H as i,Ue as j,Ae as k,Ie as l,Ve as m,le as n,$e as o,he as p,je as r,Le as s,K as t};
